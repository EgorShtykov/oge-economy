<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>–ê–¥–º–∏–Ω | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏</title>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: system-ui; max-width: 1000px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
    .student-card { background: white; padding: 20px; margin-bottom: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
    .crystals { font-size: 24px; font-weight: bold; color: #6b4ee6; }
    button { padding: 10px 20px; margin: 0 5px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
    .add { background: #4CAF50; color: white; }
    .remove { background: #f44336; color: white; }
    input[type="number"] { width: 60px; padding: 5px; }
    .phone { color: #666; font-size: 14px; }
    .last-active { font-size: 12px; color: #999; }
  </style>
</head>
<body>
  <h1>üë®‚Äçüè´ –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏</h1>
  <div id="students-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCd8k0YuzolJV1-SU5KghkgsET_rU3yH9s",
  authDomain: "egor-20d85.firebaseapp.com",
  projectId: "egor-20d85",
  storageBucket: "egor-20d85.firebasestorage.app",
  messagingSenderId: "879206703089",
  appId: "1:879206703089:web:2d0b4659b61502c4c56e50"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// –ê–Ω–æ–Ω–∏–º–Ω—ã–π –≤—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏ (–≤—Ä–µ–º–µ–Ω–Ω–æ)
auth.signInAnonymously().then(() => {
  console.log('–í–æ—à–µ–ª –∫–∞–∫ –∞–¥–º–∏–Ω');
  loadStudents();
}).catch(e => {
  console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', e);
  document.getElementById('students-list').innerHTML = '<p style="color:red;">–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</p>';
});

function loadStudents() {
  db.collection('students').get()
    .then(snapshot => {
      const container = document.getElementById('students-list');
      container.innerHTML = '';
      
      if (snapshot.empty) {
        container.innerHTML = '<p>–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</p>';
        return;
      }
      
      snapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement('div');
        div.className = 'student-card';
        div.innerHTML = `
          <div>
            <div style="font-size:18px; font-weight:bold;">${data.phone || '–ê–Ω–æ–Ω–∏–º'}</div>
            <div style="font-size:12px; color:#666;">–ö—Ä–∏—Å—Ç–∞–ª–ª—ã: ${data.crystals || 0}</div>
          </div>
          <div>
            <input type="number" id="amt-${doc.id}" value="10" style="width:60px;">
            <button class="add" onclick="updateCrystals('${doc.id}', 1)">+</button>
            <button class="remove" onclick="updateCrystals('${doc.id}', -1)">-</button>
          </div>
        `;
        container.appendChild(div);
      });
    })
    .catch(error => {
      console.error(error);
      document.getElementById('students-list').innerHTML = '<p style="color:red;">' + error.message + '</p>';
    });
}

async function updateCrystals(id, mult) {
  const amt = parseInt(document.getElementById(`amt-${id}`).value) * mult;
  await db.collection('students').doc(id).update({
    crystals: firebase.firestore.FieldValue.increment(amt)
  });
  alert(mult > 0 ? `+${amt} üíé` : `-${Math.abs(amt)} üíé`);
  loadStudents(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
}
</script>
</body>

</html>



