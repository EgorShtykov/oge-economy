<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>üíé –õ–∞–≤–∫–∞ –ø—Ä–∏–∑–æ–≤ | –û–ì–≠ –≠–∫–æ–Ω–æ–º–∏–∫–∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 40px 20px; color: white; }
        h1 { font-size: clamp(2rem, 6vw, 3rem); margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .subtitle { font-size: clamp(1rem, 3vw, 1.3rem); opacity: 0.95; }
        
        .nav-tabs { display: flex; gap: 10px; justify-content: center; margin-bottom: 30px; flex-wrap: wrap; }
        .nav-tab { background: rgba(255,255,255,0.2); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: all 0.3s; }
        .nav-tab:hover { background: rgba(255,255,255,0.3); }
        .nav-tab.active { background: white; color: #667eea; }
        
        .balance-section { background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); text-align: center; }
        .balance-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; }
        .balance-item { padding: 20px; border-radius: 15px; background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%); }
        .balance-icon { font-size: 3rem; margin-bottom: 10px; }
        .balance-amount { font-size: 2.5rem; font-weight: bold; color: #667eea; }
        .balance-label { color: #666; font-size: 0.9rem; }
        .streak-badge { display: inline-flex; align-items: center; gap: 5px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%); color: white; padding: 8px 15px; border-radius: 20px; font-weight: bold; margin-top: 10px; }
        
        .section { display: none; animation: fadeIn 0.3s ease-out; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .category-title { font-size: 1.4rem; color: #667eea; margin: 30px 0 15px; padding-bottom: 10px; border-bottom: 2px solid #e0e0e0; }
        .shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; margin-bottom: 40px; }
        .shop-card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); transition: all 0.3s; position: relative; overflow: hidden; }
        .shop-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .shop-card.sold-out { opacity: 0.6; }
        .shop-card.sold-out::after { content: '–†–ê–°–ü–†–û–î–ê–ù–û'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); background: #f44336; color: white; padding: 10px 30px; font-weight: bold; font-size: 1.2rem; }
        .shop-icon { font-size: 4rem; margin-bottom: 15px; text-align: center; }
        .shop-name { font-size: 1.3rem; font-weight: bold; color: #333; margin-bottom: 10px; text-align: center; }
        .shop-desc { color: #666; font-size: 0.95rem; margin-bottom: 15px; text-align: center; min-height: 45px; }
        .shop-stock { text-align: center; color: #999; font-size: 0.85rem; margin-bottom: 15px; }
        .shop-price { text-align: center; font-size: 1.5rem; font-weight: bold; color: #667eea; margin-bottom: 15px; }
        .shop-real-price { text-align: center; color: #4caf50; font-size: 0.9rem; margin-bottom: 10px; }
        .buy-btn { width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .buy-btn:hover:not(:disabled) { transform: scale(1.02); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        .buy-btn:disabled { background: #ccc; cursor: not-allowed; }
        
        .auction-item { background: white; border-radius: 20px; padding: 30px; margin-bottom: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .auction-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .auction-title { font-size: 1.5rem; color: #333; }
        .auction-status { background: #ffd700; color: #333; padding: 8px 15px; border-radius: 20px; font-weight: bold; }
        .auction-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .auction-info-item { background: #f5f5f5; padding: 15px; border-radius: 10px; }
        .auction-info-label { color: #666; font-size: 0.9rem; margin-bottom: 5px; }
        .auction-info-value { font-size: 1.3rem; font-weight: bold; color: #667eea; }
        .bid-section { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        .bid-input { flex: 1; min-width: 150px; padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 1.1rem; }
        .bid-btn { background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%); color: #333; border: none; padding: 15px 30px; border-radius: 10px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .bid-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4); }
        .auction-rules { background: #fff3e0; border-left: 4px solid #ff9800; padding: 15px; border-radius: 0 10px 10px 0; margin-top: 20px; }
        
        .action-buttons { display: flex; gap: 15px; justify-content: center; margin-top: 30px; flex-wrap: wrap; }
        .action-btn { padding: 15px 30px; border-radius: 25px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s; border: none; text-decoration: none; display: inline-flex; align-items: center; gap: 10px; }
        .action-btn.primary { background: white; color: #667eea; }
        .action-btn.secondary { background: rgba(255,255,255,0.2); color: white; border: 2px solid white; }
        .action-btn:hover { transform: scale(1.05); }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; justify-content: center; align-items: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 20px; padding: 40px; max-width: 500px; width: 100%; text-align: center; animation: modalPopup 0.3s ease-out; }
        .modal-icon { font-size: 5rem; margin-bottom: 20px; }
        .modal-title { font-size: 1.8rem; color: #667eea; margin-bottom: 15px; }
        .modal-text { color: #666; margin-bottom: 25px; font-size: 1.1rem; }
        .modal-close { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 40px; border-radius: 25px; font-size: 1rem; font-weight: bold; cursor: pointer; }
        
        @keyframes modalPopup { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .nav-tabs { flex-direction: column; align-items: center; }
            .nav-tab { width: 100%; max-width: 300px; }
            .shop-grid { grid-template-columns: 1fr; }
            .auction-header { flex-direction: column; text-align: center; }
            .bid-section { flex-direction: column; }
            .bid-input, .bid-btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üíé –õ–∞–≤–∫–∞ –ø—Ä–∏–∑–æ–≤</h1>
            <p class="subtitle">–¢—Ä–∞—Ç—å –∫—Ä–∏—Å—Ç–∞–ª–ª—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑—ã!</p>
        </header>
        
        <div class="balance-section">
            <div class="balance-grid">
                <div class="balance-item">
                    <div class="balance-icon">üíé</div>
                    <div class="balance-amount" id="crystals">0</div>
                    <div class="balance-label">–∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤</div>
                </div>
                <div class="balance-item">
                    <div class="balance-icon">‚≠ê</div>
                    <div class="balance-amount" id="xp">0</div>
                    <div class="balance-label">XP (—Ä–µ–π—Ç–∏–Ω–≥)</div>
                </div>
            </div>
            <div class="streak-badge" id="streak-badge" style="display: none;">üî• <span id="streak-days">0</span> –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('shop')">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="nav-tab" onclick="showSection('auction')">üèÜ –ê—É–∫—Ü–∏–æ–Ω</button>
        </div>
        
        <!-- –ú–ê–ì–ê–ó–ò–ù -->
        <div id="shop-section" class="section active">
            <div class="category-title">üç¨ –ú–µ–ª–∫–∏–µ –ø—Ä–∏–∑—ã (80-200 üíé)</div>
            <div class="shop-grid" id="shop-grid-small"></div>
            
            <div class="category-title">üéÅ –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–∏–∑—ã (250-400 üíé)</div>
            <div class="shop-grid" id="shop-grid-medium"></div>
            
            <div class="category-title">üíé –ö—Ä—É–ø–Ω—ã–µ –ø—Ä–∏–∑—ã (600-700 üíé)</div>
            <div class="shop-grid" id="shop-grid-large"></div>
            
            <div class="category-title">üé´ –ë–æ–Ω—É—Å–Ω—ã–µ (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ)</div>
            <div class="shop-grid" id="shop-grid-bonus"></div>
        </div>
        
        <!-- –ê–£–ö–¶–ò–û–ù -->
        <div id="auction-section" class="section">
            <div id="auction-container"></div>
            <div class="auction-rules">
                <strong>üìã –ü—Ä–∞–≤–∏–ª–∞ –∞—É–∫—Ü–∏–æ–Ω–∞:</strong>
                <ul style="margin-top: 10px; padding-left: 20px;">
                    <li>–°—Ç–∞–≤–∫–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞</li>
                    <li>–ü–æ–±–µ–∂–¥–∞–µ—Ç highest bidder (–∑–∞–∫—Ä—ã—Ç—ã–µ —Å—Ç–∞–≤–∫–∏)</li>
                    <li>–ï—Å–ª–∏ –Ω–∏–∫—Ç–æ –Ω–µ –Ω–∞–±—Ä–∞–ª –º–∏–Ω–∏–º—É–º ‚Äî –ø—Ä–∏–∑ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è</li>
                    <li>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∏–∑ –≤ –Ω–∞—á–∞–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞</li>
                </ul>
            </div>
        </div>
        
        <div class="action-buttons">
            <a href="index.html" class="action-btn secondary">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    </div>
    
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-icon" id="modal-icon">üéâ</div>
            <div class="modal-title" id="modal-title">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</div>
            <div class="modal-text" id="modal-text">–¢—ã –∫—É–ø–∏–ª –ø—Ä–∏–∑!</div>
            <button class="modal-close" onclick="closeModal()">–û—Ç–ª–∏—á–Ω–æ!</button>
        </div>
    </div>

    <script src="reward-system-v2.js"></script>
    <script>
        function updateDisplay() {
            let stats;
            try { stats = OGEEconomy ? OGEEconomy.getStats() : { crystals: 0, xp: 0, streak: 0 }; } 
            catch (e) { stats = { crystals: 0, xp: 0, streak: 0 }; }
            
            document.getElementById('crystals').textContent = stats.crystals || 0;
            document.getElementById('xp').textContent = stats.xp || 0;
            
            if (stats.streak > 0) {
                document.getElementById('streak-days').textContent = stats.streak;
                document.getElementById('streak-badge').style.display = 'inline-flex';
            }
        }

        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(section + '-section').classList.add('active');
            event.target.classList.add('active');
        }

        function renderShop() {
            const categories = {
                'small': document.getElementById('shop-grid-small'),
                'medium': document.getElementById('shop-grid-medium'),
                'large': document.getElementById('shop-grid-large'),
                'bonus': document.getElementById('shop-grid-bonus')
            };
            
            let stats, currentMonth;
            try {
                stats = OGEEconomy ? OGEEconomy.getStats() : { crystals: 0, purchases: [], studentName: '' };
                currentMonth = new Date().getMonth();
            } catch (e) {
                stats = { crystals: 0, purchases: [], studentName: '' };
                currentMonth = new Date().getMonth();
            }
            
            if (typeof SHOP_ITEMS === 'undefined') return;
            
            SHOP_ITEMS.forEach(item => {
                const grid = categories[item.category];
                if (!grid) return;
                
                const purchases = stats.purchases || [];
                const bought = purchases.filter(p => p.itemId === item.id && p.month === currentMonth).length;
                const studentBought = purchases.filter(p => p.itemId === item.id && p.month === currentMonth && p.studentName === stats.studentName).length;
                
                const isSoldOut = bought >= item.stock;
                const isLimitReached = studentBought >= item.limitPerStudent;
                const canAfford = (stats.crystals || 0) >= item.price;
                
                const card = document.createElement('div');
                card.className = 'shop-card' + (isSoldOut ? ' sold-out' : '');
                card.innerHTML = `
                    <div class="shop-icon">${item.name.split(' ')[0]}</div>
                    <div class="shop-name">${item.name.split(' ').slice(1).join(' ')}</div>
                    <div class="shop-desc">${item.description}</div>
                    ${item.realPrice > 0 ? `<div class="shop-real-price">üí∞ –†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: ${item.realPrice}‚ÇΩ</div>` : ''}
                    <div class="shop-price">üíé ${item.price}</div>
                    <div class="shop-stock">–û—Å—Ç–∞–ª–æ—Å—å: ${item.stock - bought} –∏–∑ ${item.stock}</div>
                    <button class="buy-btn" onclick="buyItem('${item.id}')" ${isSoldOut || isLimitReached || !canAfford ? 'disabled' : ''}>
                        ${isSoldOut ? '–†–∞—Å–ø—Ä–æ–¥–∞–Ω–æ' : isLimitReached ? '–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω' : !canAfford ? '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üíé' : '–ö—É–ø–∏—Ç—å'}
                    </button>
                `;
                grid.appendChild(card);
            });
        }

        function buyItem(itemId) {
            if (OGEEconomy.buyItem(itemId)) {
                setTimeout(() => location.reload(), 2000);
            }
        }

        function renderAuction() {
            const container = document.getElementById('auction-container');
            if (!container) return;
            
            let stats, currentMonth;
            try {
                stats = OGEEconomy ? OGEEconomy.getStats() : { auctionBids: [], studentName: '' };
                currentMonth = new Date().getMonth();
            } catch (e) {
                stats = { auctionBids: [], studentName: '' };
                currentMonth = new Date().getMonth();
            }
            
            if (typeof AUCTION_ITEMS === 'undefined') return;
            
            AUCTION_ITEMS.forEach(item => {
                const myBid = stats.auctionBids.find(b => b.itemId === item.id && b.month === currentMonth && b.studentName === stats.studentName);
                
                const div = document.createElement('div');
                div.className = 'auction-item';
                div.innerHTML = `
                    <div class="auction-header">
                        <div class="auction-title">${item.name}</div>
                        <div class="auction-status">üèÜ –ê–∫—Ç–∏–≤–µ–Ω</div>
                    </div>
                    <div class="auction-info">
                        <div class="auction-info-item">
                            <div class="auction-info-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                            <div class="auction-info-value" style="font-size: 1rem; color: #333;">${item.description}</div>
                        </div>
                        <div class="auction-info-item">
                            <div class="auction-info-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞</div>
                            <div class="auction-info-value">üíé ${item.minBid}</div>
                        </div>
                        <div class="auction-info-item">
                            <div class="auction-info-label">–†–µ–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                            <div class="auction-info-value">${item.realPrice}‚ÇΩ</div>
                        </div>
                        ${myBid ? `<div class="auction-info-item" style="background: #e8f5e9;"><div class="auction-info-label">–¢–≤–æ—è —Å—Ç–∞–≤–∫–∞</div><div class="auction-info-value" style="color: #4caf50;">üíé ${myBid.amount}</div></div>` : ''}
                    </div>
                    <div class="bid-section">
                        <input type="number" class="bid-input" id="bid-${item.id}" placeholder="–¢–≤–æ—è —Å—Ç–∞–≤–∫–∞ (–º–∏–Ω. ${item.minBid})" min="${item.minBid}">
                        <button class="bid-btn" onclick="placeBid('${item.id}')">ü§´ –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function placeBid(itemId) {
            const input = document.getElementById(`bid-${itemId}`);
            const amount = parseInt(input.value);
            if (!amount || amount <= 0) { alert('–í–≤–µ–¥–∏ —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏!'); return; }
            if (OGEEconomy.placeBid(itemId, amount)) {
                input.value = '';
                setTimeout(() => location.reload(), 1500);
            }
        }

        function closeModal() { document.getElementById('modal').classList.remove('active'); }
        document.getElementById('modal').addEventListener('click', function(e) { if (e.target === this) closeModal(); });

        document.addEventListener('DOMContentLoaded', function() {
            updateDisplay();
            renderShop();
            renderAuction();
        });
    </script>
</body>
</html>
